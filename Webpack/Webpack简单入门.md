## ä»€ä¹ˆæ˜¯ Webpackï¼Ÿ

è‡ªä»å‡ºç°æ¨¡å—åŒ–ä»¥åï¼Œæˆ‘ä»¬å¯ä»¥å°†åŸæœ¬ä¸€å¨ä»£ç åˆ†ç¦»åˆ°ä¸ªä¸ªæ¨¡å—ä¸­ï¼Œä½†æ˜¯ç”±æ­¤å¼•å‘äº†ä¸€ä¸ªé—®é¢˜ã€‚æ¯ä¸ª JS æ–‡ä»¶éƒ½éœ€è¦ä»æœåŠ¡å™¨å»æ‹¿ï¼Œè¿™æ ·ä¼šå¯¼è‡´é¡µé¢åŠ è½½é€Ÿåº¦å˜æ…¢ã€‚Webpack æœ€ä¸»è¦çš„ç›®çš„å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°†æ‰€æœ‰å°æ–‡ä»¶æ‰“åŒ…æˆä¸€ä¸ªæˆ–å¤šä¸ªå¤§æ–‡ä»¶ï¼Œå®˜ç½‘çš„å›¾ç‰‡å°±å¾ˆå¥½çš„è¯ é‡Šäº†è¿™ä¸ªäº‹æƒ…ã€‚

![webpack](./images/webpack.png)



**WebPackæ˜¯ä¸€ä¸ªç°ä»£ JavaScript åº”ç”¨ç¨‹åºçš„é™æ€æ¨¡å—æ‰“åŒ…å™¨(module bundler)ï¼š**

å®ƒä¼šåˆ†æä½ çš„é¡¹ç›®ç»“æ„ï¼Œæ‰¾åˆ°JavaScriptæ¨¡å—ä»¥åŠå…¶å®ƒçš„ä¸€äº›æµè§ˆå™¨ä¸èƒ½ç›´æ¥è¿è¡Œçš„æ‰©å±•è¯­è¨€(å¦‚ES6ã€TypeScriptã€Sassç­‰)ï¼Œå°†å…¶è½¬æ¢å’Œæ‰“åŒ…ä¸ºåˆé€‚çš„æ ¼å¼åä¾›æµè§ˆå™¨ä½¿ç”¨ã€‚

## Webpack æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ

å½“ webpack å¤„ç†åº”ç”¨ç¨‹åºæ—¶ï¼Œå®ƒä¼šé€’å½’åœ°æ„å»ºä¸€ä¸ªä¾èµ–å…³ç³»å›¾(dependency graph)ï¼Œå…¶ä¸­åŒ…å«åº”ç”¨ç¨‹åºéœ€è¦çš„æ¯ä¸ªæ¨¡å—ï¼Œç„¶åå°†æ‰€æœ‰è¿™äº›æ¨¡å—æ‰“åŒ…æˆä¸€ä¸ªæˆ–å¤šä¸ª bundleã€‚

æ„å»ºå°±æ˜¯æŠŠæºä»£ç è½¬æ¢æˆå‘å¸ƒåˆ°çº¿ä¸Šå¯æ‰§è¡Œçš„ JavaScriptã€CSSã€HTML ä»£ç ï¼ŒåŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š

- **ä»£ç è½¬æ¢**ï¼šTypeScript ç¼–è¯‘æˆ JavaScriptã€SCSS ç¼–è¯‘æˆ CSS ç­‰
- **æ–‡ä»¶ä¼˜åŒ–**ï¼šå‹ç¼© JavaScriptã€CSSã€HTML ä»£ç ï¼Œå‹ç¼©åˆå¹¶å›¾ç‰‡ç­‰
- **ä»£ç åˆ†å‰²**ï¼šæå–å¤šä¸ªé¡µé¢çš„å…¬å…±ä»£ç ã€æå–é¦–å±ä¸éœ€è¦æ‰§è¡Œéƒ¨åˆ†çš„ä»£ç è®©å…¶å¼‚æ­¥åŠ è½½
- **æ¨¡å—åˆå¹¶**ï¼šåœ¨é‡‡ç”¨æ¨¡å—åŒ–çš„é¡¹ç›®æœ‰å¾ˆå¤šæ¨¡å—å’Œæ–‡ä»¶ï¼Œéœ€è¦æ„å»ºåŠŸèƒ½æŠŠæ¨¡å—åˆ†ç±»åˆå¹¶æˆä¸€ä¸ªæ–‡ä»¶
- **è‡ªåŠ¨åˆ·æ–°**ï¼šç›‘å¬æœ¬åœ°æºä»£ç çš„å˜åŒ–ï¼Œè‡ªåŠ¨æ„å»ºï¼Œåˆ·æ–°æµè§ˆå™¨
- **ä»£ç æ ¡éªŒ**ï¼šåœ¨ä»£ç è¢«æäº¤åˆ°ä»“åº“å‰éœ€è¦æ£€æµ‹ä»£ç æ˜¯å¦ç¬¦åˆè§„èŒƒï¼Œä»¥åŠå•å…ƒæµ‹è¯•æ˜¯å¦é€šè¿‡
- **è‡ªåŠ¨å‘å¸ƒ**ï¼šæ›´æ–°å®Œä»£ç åï¼Œè‡ªåŠ¨æ„å»ºå‡ºçº¿ä¸Šå‘å¸ƒä»£ç å¹¶ä¼ è¾“ç»™å‘å¸ƒç³»ç»Ÿ

 æ„å»ºå…¶å®æ˜¯å·¥ç¨‹åŒ–ã€è‡ªåŠ¨åŒ–æ€æƒ³åœ¨å‰ç«¯å¼€å‘ä¸­çš„ä½“ç°ã€‚æŠŠä¸€ç³»åˆ—æµç¨‹ç”¨ä»£ç å»å®ç°ï¼Œè®©ä»£ç è‡ªåŠ¨åŒ–åœ°æ‰§è¡Œè¿™ä¸€ç³»åˆ—å¤æ‚çš„æµç¨‹ã€‚

## webpack çš„åŸºæœ¬æ¦‚å¿µ

**[å…¥å£(entry point)](https://link.juejin.im/?target=https%3A%2F%2Fwww.webpackjs.com%2Fconcepts%2Fentry-points%2F)**

æŒ‡ç¤º webpack åº”è¯¥ä½¿ç”¨å“ªä¸ªæ¨¡å—ï¼Œæ¥ä½œä¸ºæ„å»ºå…¶å†…éƒ¨ä¾èµ–å›¾çš„å¼€å§‹ï¼Œwebpack ä¼šæ‰¾å‡ºæœ‰å“ªäº›æ¨¡å—å’Œ library æ˜¯å…¥å£èµ·ç‚¹ï¼ˆç›´æ¥å’Œé—´æ¥ï¼‰ä¾èµ–çš„ã€‚

> é»˜è®¤å€¼æ˜¯ `./src/index.js`ï¼Œç„¶è€Œï¼Œå¯ä»¥é€šè¿‡åœ¨ webpack é…ç½®ä¸­é…ç½® entry å±æ€§ï¼Œæ¥æŒ‡å®šä¸€ä¸ªä¸åŒçš„å…¥å£èµ·ç‚¹ï¼ˆæˆ–è€…ä¹Ÿå¯ä»¥æŒ‡å®šå¤šä¸ªå…¥å£èµ·ç‚¹ï¼‰ã€‚

**[å‡ºå£(output)](https://link.juejin.im/?target=https%3A%2F%2Fwww.webpackjs.com%2Fconcepts%2Foutput%2F)**

å‘Šè¯‰ webpack åœ¨å“ªé‡Œè¾“å‡ºå®ƒæ‰€åˆ›å»ºçš„ bundlesï¼Œä»¥åŠå¦‚ä½•å‘½åè¿™äº›æ–‡ä»¶ã€‚

> ä¸»è¾“å‡ºæ–‡ä»¶é»˜è®¤ä¸º `./dist/main.js`ï¼Œå…¶ä»–ç”Ÿæˆæ–‡ä»¶çš„é»˜è®¤è¾“å‡ºç›®å½•æ˜¯ `./dist`

**[åŠ è½½å™¨(loader)](https://link.juejin.im/?target=https%3A%2F%2Fwww.webpackjs.com%2Fconcepts%2Floaders%2F)**

è®© webpack èƒ½å¤Ÿå»å¤„ç†é‚£äº›é JavaScript æ–‡ä»¶ï¼ˆwebpack æœ¬èº«åªèƒ½åŠ è½½ JavaScript/JSONæ¨¡å—ï¼‰ã€‚loader å¯ä»¥å°†æ‰€æœ‰ç±»å‹çš„èµ„æºæ–‡ä»¶è½¬æ¢ä¸º webpack èƒ½å¤Ÿå¤„ç†çš„æœ‰æ•ˆæ¨¡å—ï¼Œç„¶åä½ å°±å¯ä»¥åˆ©ç”¨ webpack çš„æ‰“åŒ…èƒ½åŠ›ï¼Œå¯¹å®ƒä»¬è¿›è¡Œå¤„ç†ã€‚

> loaderæœ¬èº«æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ¥å—æºæ–‡ä»¶ä½œä¸ºå‚æ•°ï¼Œè¿”å›è½¬æ¢åçš„ç»“æœã€‚æ³¨æ„ï¼Œloader èƒ½å¤Ÿ import å¯¼å…¥ä»»ä½•ç±»å‹çš„æ¨¡å—ï¼ˆä¾‹å¦‚ .css æ–‡ä»¶ï¼‰ï¼Œè¿™æ˜¯ webpack ç‰¹æœ‰çš„åŠŸèƒ½ï¼Œå…¶ä»–æ‰“åŒ…ç¨‹åºæˆ–ä»»åŠ¡æ‰§è¡Œå™¨çš„å¯èƒ½å¹¶ä¸æ”¯æŒã€‚æˆ‘ä»¬è®¤ä¸ºè¿™ç§è¯­è¨€æ‰©å±•æ˜¯æœ‰å¾ˆå¿…è¦çš„ï¼Œå› ä¸ºè¿™å¯ä»¥ä½¿å¼€å‘äººå‘˜åˆ›å»ºå‡ºæ›´å‡†ç¡®çš„ä¾èµ–å…³ç³»å›¾ã€‚

[æ’ä»¶(plugins)](https://link.juejin.im/?target=https%3A%2F%2Fwww.webpackjs.com%2Fconcepts%2Fplugins%2F)

loader è¢«ç”¨äºè½¬æ¢æŸäº›ç±»å‹çš„æ¨¡å—ï¼Œè€Œæ’ä»¶åˆ™å¯ä»¥ç”¨äºæ‰§è¡ŒèŒƒå›´æ›´å¹¿çš„ä»»åŠ¡ã€‚æ’ä»¶çš„èŒƒå›´åŒ…æ‹¬ï¼Œä»æ‰“åŒ…ä¼˜åŒ–å’Œå‹ç¼©ï¼Œä¸€ç›´åˆ°é‡æ–°å®šä¹‰ç¯å¢ƒä¸­çš„å˜é‡ã€‚æ’ä»¶æ¥å£åŠŸèƒ½æå…¶å¼ºå¤§ï¼Œå¯ä»¥ç”¨æ¥å¤„ç†å„ç§å„æ ·çš„ä»»åŠ¡ã€‚

> å¸¸ç”¨æ’ä»¶ï¼š
>
> - CleanWebpackPluginï¼šè‡ªåŠ¨æ¸…é™¤æŒ‡å®šæ–‡ä»¶å¤¹èµ„æº
> - HtmlWebopackPluginï¼šæ ¹æ®æ¨¡æ¿è‡ªåŠ¨ç”Ÿæˆhtmlå¹¶å¼•å…¥scriptè„šæœ¬
> - UglifyJSPluginï¼šå‹ç¼©JSä»£ç 

**[æ¨¡å¼(mode)](https://link.juejin.im/?target=https%3A%2F%2Fwww.webpackjs.com%2Fconcepts%2Fmode%2F)**

é€šè¿‡é€‰æ‹© `development` å¼€å‘ç¯å¢ƒæˆ– `production` ç”Ÿäº§ç¯å¢ƒä¹‹ä¸­çš„ä¸€ä¸ªï¼Œæ¥è®¾ç½® mode å‚æ•°ï¼Œä»è€Œå¯ç”¨ç›¸åº”æ¨¡å¼ä¸‹çš„ webpack å†…ç½®çš„ä¼˜åŒ–ã€‚

> ç®€å•æ¥è¯´ï¼Œå¼€å‘æ—¶å¯èƒ½éœ€è¦æ‰“å° debug ä¿¡æ¯ï¼Œè¿˜æœ‰å®šä¹‰ `sourcemap` ã€`UglifyJSPlugin`æ–‡ä»¶ï¼Œè€Œç”Ÿäº§ç¯å¢ƒæ˜¯ç”¨äºçº¿ä¸Šçš„å³ä»£ç éƒ½æ˜¯å‹ç¼©åï¼Œè¿è¡Œæ—¶ä¸æ‰“å° debug ä¿¡æ¯ç­‰ã€‚è­¬å¦‚ axiosã€antd ç­‰æˆ‘ä»¬çš„ç”Ÿäº§ç¯å¢ƒä¸­éœ€è¦ä½¿ç”¨åˆ°é‚£ä¹ˆæˆ‘ä»¬åº”è¯¥å®‰è£…è¯¥ä¾èµ–åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè€Œ `webpack-dev-server` åˆ™æ˜¯éœ€è¦å®‰è£…åœ¨å¼€å‘ç¯å¢ƒä¸­ã€‚

**webpack æ„å»ºè¿‡ç¨‹ï¼š**

1. ä» Entry é‡Œé…ç½®çš„ Module å¼€å§‹é€’å½’è§£æ Entry ä¾èµ–çš„æ‰€æœ‰ Moduleã€‚
2. æ¯æ‰¾åˆ°ä¸€ä¸ª Moduleï¼Œ å°±ä¼šæ ¹æ®é…ç½®çš„ Loader å»æ‰¾å‡ºå¯¹åº”çš„è½¬æ¢è§„åˆ™ã€‚
3. æ¯æ‰¾åˆ°ä¸€ä¸ª Moduleï¼Œ å°±ä¼šæ ¹æ®é…ç½®çš„ Loader å»æ‰¾å‡ºå¯¹åº”çš„è½¬æ¢è§„åˆ™ã€‚
4. è¿™äº›æ¨¡å—ä¼šä»¥ Entry ä¸ºå•ä½è¿›è¡Œåˆ†ç»„ï¼Œä¸€ä¸ª Entry å’Œå…¶æ‰€æœ‰ä¾èµ–çš„ Module è¢«åˆ†åˆ°ä¸€ä¸ªç»„ä¹Ÿå°±æ˜¯ä¸€ä¸ª Chunk(ç¼–ç å—)ã€‚
5. æœ€å Webpack ä¼šæŠŠæ‰€æœ‰ Chunk è½¬æ¢æˆæ–‡ä»¶è¾“å‡ºã€‚
6. åœ¨æ•´ä¸ªæµç¨‹ä¸­ Webpack ä¼šåœ¨æ°å½“çš„æ—¶æœºæ‰§è¡Œ Plugin é‡Œå®šä¹‰çš„é€»è¾‘ã€‚



## WebPack VS Grunt/Gulpï¼Ÿ

**å…¶å®Webpackå’Œå¦å¤–ä¸¤ä¸ªå¹¶æ²¡æœ‰å¤ªå¤šçš„å¯æ¯”æ€§ï¼ŒGulp/Gruntæ˜¯ä¸€ç§èƒ½å¤Ÿä¼˜åŒ–å‰ç«¯å¼€å‘å·¥ä½œæµç¨‹çš„å·¥å…·ï¼Œè€ŒWebPackæ˜¯ä¸€ç§æ¨¡å—åŒ–çš„è§£å†³æ–¹æ¡ˆï¼Œä¸è¿‡Webpackçš„ä¼˜ç‚¹ä½¿å¾—Webpackåœ¨å¾ˆå¤šåœºæ™¯ä¸‹å¯ä»¥æ›¿ä»£Gulp/Gruntç±»çš„å·¥å…·ã€‚**

### Grunt å’Œ Gulp çš„å·¥ä½œæ–¹å¼

åœ¨ä¸€ä¸ªé…ç½®æ–‡ä»¶ä¸­ï¼ŒæŒ‡æ˜å¯¹æŸäº›æ–‡ä»¶è¿›è¡Œç±»ä¼¼ç¼–è¯‘ï¼Œç»„åˆï¼Œå‹ç¼©ç­‰ä»»åŠ¡çš„å…·ä½“æ­¥éª¤ï¼Œè¿™ä¸ªå·¥å…·ä¹‹åå¯ä»¥è‡ªåŠ¨æ›¿ä½ å®Œæˆè¿™äº›ä»»åŠ¡ã€‚

![Gruntå’ŒGulpçš„å·¥ä½œæµç¨‹](./images/gulpå·¥ä½œæµç¨‹.png)



### Webpack çš„å·¥ä½œæ–¹å¼

æŠŠä½ çš„é¡¹ç›®å½“åšä¸€ä¸ªæ•´ä½“ï¼Œé€šè¿‡ä¸€ä¸ªç»™å®šçš„ä¸»æ–‡ä»¶ï¼ˆå¦‚ï¼šindex.jsï¼‰ï¼ŒWebpackå°†ä»è¿™ä¸ªæ–‡ä»¶å¼€å§‹æ‰¾åˆ°ä½ çš„é¡¹ç›®çš„æ‰€æœ‰ä¾èµ–æ–‡ä»¶ï¼ˆå¦‚ï¼šcomponent.js ã€helper.js ï¼‰ï¼Œç„¶åå°†è¿™äº›æ¨¡å—ä½¿ç”¨ä¸åŒçš„loadersï¼ˆç¬¬ä¸‰æ–¹åŒ…ï¼‰æ¥å¤„ç†å®ƒä»¬ï¼Œæœ€åæ‰“åŒ…ä¸ºä¸€ä¸ªæµè§ˆå™¨å¯è¯†åˆ«çš„JavaScriptæ–‡ä»¶ã€‚ï¼ˆå¦‚ï¼šapp.jsï¼‰

![webpackçš„å·¥ä½œæµç¨‹](./images/webpackå·¥ä½œæµç¨‹.png)



## æ­å»ºå‰ç«¯å¼€å‘ç¯å¢ƒ

åœ¨æ˜ç™½äº†Webpackçš„æ¦‚å¿µä¹‹åï¼Œæˆ‘ä»¬ç°åœ¨ä¸€æ­¥æ­¥çš„å¼€å§‹ç®€å•çš„ä½¿ç”¨Webpack4.0+æ­å»ºåŸºæœ¬çš„å‰ç«¯å¼€å‘ç¯å¢ƒã€‚

**ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š**

- æ‰“åŒ…æ„å»ºå‘å¸ƒéœ€è¦çš„ HTMLã€CSSã€JSã€å›¾ç‰‡ç­‰èµ„æº
- é…ç½® babel è½¬ç å™¨ï¼Œ ä½¿ç”¨ es6+è¯­æ³•
- ä½¿ç”¨ CSS é¢„å¤„ç†å™¨ï¼Œè¿™é‡Œä½¿ç”¨ scss
- å¤„ç†å’Œå‹ç¼©å›¾ç‰‡
- é…ç½®çƒ­åŠ è½½ï¼ŒHMR

### å®‰è£…å‘½ä»¤

```bash
1ã€å¸è½½é»˜è®¤ï¼š 
npm uninstall webpack

2ã€å…¨å±€å®‰è£…ï¼š
npm install webpack -g

3ã€å±€éƒ¨å®‰è£…ï¼š 
npm install webpack webpack-cli --save-dev
// å°† webpack å’Œ webpack-cli æ”¾å…¥é¡¹ç›®å¼€å‘ç¯å¢ƒä¾èµ–ä¸­
```

> - ä¸æ¨èå…¨å±€å®‰è£…ï¼Œå®ƒä¼šå°†ä½ é¡¹ç›®ä¸­çš„ webpack é”å®šåˆ°æŒ‡å®šç‰ˆæœ¬ï¼Œå¹¶ä¸”åœ¨ä½¿ç”¨ä¸åŒçš„ webpack ç‰ˆæœ¬çš„é¡¹ç›®ä¸­ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ„å»ºå¤±è´¥ã€‚
> - webpack å³ webpack æ ¸å¿ƒåº“ã€‚å®ƒæä¾›äº†å¾ˆå¤š [API](https://webpack.js.org/api/node/), åœ¨Node.js è„šæœ¬ä¸­é€šè¿‡  `require('webpack')` çš„æ–¹å¼æ¥ä½¿ç”¨ webpackã€‚
> - webpack-cli æ˜¯ webpack çš„å‘½ä»¤è¡Œå·¥å…·ã€‚è®©æˆ‘ä»¬å¯ä»¥ä¸ç”¨å†™æ‰“åŒ…è„šæœ¬ï¼Œåªéœ€é…ç½®æ‰“åŒ…é…ç½®æ–‡ä»¶ï¼Œç„¶ååœ¨å‘½ä»¤è¡Œè¾“å…¥ `webpack-cli --config webpack.config.js` æ¥ä½¿ç”¨ webpack, ç®€å•å¾ˆå¤šã€‚webpack 4 ä¹‹å‰å‘½ä»¤è¡Œå·¥å…·æ˜¯é›†æˆåœ¨ webpack åŒ…ä¸­çš„ï¼Œ4.0 å¼€å§‹ webpack åŒ…æœ¬èº«ä¸å†é›†æˆ cliã€‚
> - webpack-serve (éå¿…éœ€) æ˜¯ webpack æä¾›çš„ç”¨æ¥å¼€å‘è°ƒè¯•çš„æœåŠ¡å™¨ï¼Œè®©ä½ å¯ä»¥ç”¨ <http://127.0.0.1:8080/> è¿™æ ·çš„ url æ‰“å¼€é¡µé¢æ¥è°ƒè¯•ï¼Œæœ‰äº†å®ƒå°±ä¸ç”¨é…ç½® [nginx](https://nginx.org/en/) äº†ï¼Œæ–¹ä¾¿å¾ˆå¤šã€‚

### å‡†å¤‡å·¥ä½œ

```bash
1. æ–°å»ºä¸€ä¸ªç©ºçš„ç»ƒä¹ æ–‡ä»¶å¤¹
mkdir  webpack-demo
cd webpack-demo

2. åˆ›å»º package.json npmçš„è¯´æ˜æ–‡ä»¶
// åŒ…æ‹¬å½“å‰é¡¹ç›®çš„åŸºæœ¬ä¿¡æ¯ï¼Œä¾èµ–æ¨¡å—ï¼Œè‡ªå®šä¹‰çš„è„šæœ¬ä»»åŠ¡
npm init 
// è¿™é‡Œä¼šé—®ä¸€äº›é—®é¢˜ï¼Œå¯ä»¥ç›´æ¥å›è½¦è·³è¿‡æˆ–è€… npm init -y

3. å±€éƒ¨å®‰è£…
npm i webpack webpack-cli -D

4. åˆ›å»ºé¡¹ç›®ä»£ç æ–‡ä»¶å¤¹src
mkdir src
cd src

5. åˆ›å»ºé¡¹ç›®å…¥å£æ–‡ä»¶
touch index.html
touch index.js
```

index.htmlå…¥å£é¡µé¢ï¼š

```html
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
  </head>
  <body>
      <h2>
          è¿™æ˜¯webpack-demoçš„é¡¹ç›®å…¥å£é¡µé¢ã€‚
      </h2>
      <p id="test"></p>
  </body>
</html>
```

æ³¨æ„è¿™é‡Œæˆ‘ä»¬ä¸éœ€è¦è‡ªå·±å†™ `<script src="./index.js"></script>`ï¼Œ å› ä¸ºæ‰“åŒ…åçš„æ–‡ä»¶åå’Œè·¯å¾„å¯èƒ½ä¼šå˜ï¼Œæ‰€ä»¥æˆ‘ä»¬ç¨åç”¨ webpack æ’ä»¶å¸®æˆ‘ä»¬è‡ªåŠ¨åŠ ä¸Šã€‚

index.js å…¥å£æ–‡ä»¶ï¼š

```javascript
let testStr = 'Hello World, this is a webpack-demo.'
document.getElementById('test').innerText = testStr
console.log(testStr)
```

### è‡ªå®šä¹‰é…ç½®æ–‡ä»¶

å…¶å®webpack ä» v4.0.0 å¼€å§‹å·²ç»å¯ä»¥ä¸€ä¸ªé…ç½®æ–‡ä»¶éƒ½ä¸å†™ï¼Œå®ç°**é›¶é…ç½®**ã€‚

æ¯”å¦‚æˆ‘ä»¬æ­¤æ—¶åœ¨ç»ˆç«¯æ‰§è¡Œ`npx webpack`ï¼Œå‘ç° webpack å·²ç»æŠŠ src/index.js æ–‡ä»¶é‡Œçš„å†…å®¹æ‰“åŒ…ç”Ÿæˆåˆ°äº† dist (å°†æ¥éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶å¤¹)ç›®å½• mian.js æ–‡ä»¶é‡Œã€‚

![npx webpack](./images/npxwebpack.png)

**å…³äºå¦‚ä½•è¿è¡Œwebpack:**

- è¿™é‡Œç›´æ¥æ‰§è¡Œ webpack å‘½ä»¤ä¼šæç¤ºcommand not found: webpackï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬ä¹‹å‰æ²¡æœ‰å°† webpack ä»¥åŠ webpack-cli è¿›è¡Œå…¨å±€å®‰è£…ï¼Œè€Œæ˜¯é€‰æ‹©äº†åœ¨é¡¹ç›®å†…å±€éƒ¨å®‰è£…ã€‚
- é¡¹ç›®å†…å®‰è£…çš„ webpack å®é™…ä¸Šæ‰§è¡Œçš„æ˜¯ node_modules ç›®å½•ä¸‹ .bin ç›®å½•å†…çš„ webpack.js è„šæœ¬ï¼Œæ‰€ä»¥ä½¿ç”¨`node ./node_modules/.bin/webpack`å°±å¯ä»¥å¯åŠ¨webpackã€‚
- æ›´ç®€å•ç‚¹çš„æ–¹å¼å°±æ˜¯é€šè¿‡ npm çš„åŒ…æ‰§è¡Œå™¨ npxï¼Œ`npx command` é»˜è®¤å°±æ˜¯æ‰§è¡Œ `./node_modules` ç›®å½•ä¸­å®‰è£…çš„å¯æ‰§è¡Œè„šæœ¬ã€‚å¦‚æœè¿™é‡Œ webpack æœªå®‰è£…ï¼Œå®ƒä¹Ÿä¼šè‡ªåŠ¨ä» npm æºä¸‹è½½å®‰è£…åå†æ‰§è¡Œã€‚
- ä½†æ˜¯è¿™æ ·åœ¨4.0ç‰ˆæœ¬çš„webpackä¸­ï¼Œç»ˆç«¯ä¼šå‡ºç°æœªå®šä¹‰æ„å»ºæ¨¡å¼çš„WARNING(âš ï¸ å›¾ä¸­é»„è‰²è­¦å‘Šä¿¡æ¯)ï¼Œæ‰€ä»¥æœ€å¥½çš„æ–¹å¼æ˜¯åœ¨ package.json æ–‡ä»¶çš„ scripts é‡Œæ·»åŠ ä¸€æ®µ`"build": "webpack --mode development"`(é»˜è®¤production)åä½¿ç”¨ `npm run build` æ¥è¿è¡Œwebpackã€‚



ä½†å®é™…æƒ…å†µä¸‹å¤§å¤šæ•°é¡¹ç›®éƒ½ä¼šéœ€è¦å¾ˆå¤æ‚çš„è®¾ç½®ï¼Œè¦æƒ³ç»™ webpack å¢åŠ æ›´å¤šçš„è‡ªå®šä¹‰é…ç½®ä¿¡æ¯ï¼Œæˆ‘ä»¬å°±éœ€è¦åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»º webpack çš„é…ç½®æ–‡ä»¶ `webpack.config.js` ã€‚ç„¶åå†æ‰§è¡Œ npm run buildï¼Œwebpack å°±ä¼šä½¿ç”¨æˆ‘ä»¬åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œå®šä¹‰çš„é…ç½®ä¿¡æ¯äº†ã€‚

```cmd
cd webpack-demo
touch webpack.config.js
```

Webpack.config.js ä¸­å¸¸ç”¨çš„åŸºæœ¬é…ç½®ä¿¡æ¯ï¼š

```javascript
module.exports = {
  entry: '', // æ‰“åŒ…å…¥å£ï¼šæŒ‡ç¤º webpack åº”è¯¥ä½¿ç”¨å“ªä¸ªæ¨¡å—ï¼Œæ¥ä½œä¸ºæ„å»ºå…¶å†…éƒ¨ä¾èµ–å›¾çš„å¼€å§‹
  output: '', // å‡ºå£ç›®å½•
  mode: 'development', // åœ¨è¿™é‡Œæ›´æ”¹äº†æ¨¡å¼ï¼Œå°±ä¸å¿…åœ¨package.jsoné‡Œå†è®¾ç½® --mode
  resolve: {}, // é…ç½®è§£æï¼šé…ç½®åˆ«åã€extensions è‡ªåŠ¨è§£æç¡®å®šçš„æ‰©å±•ç­‰ç­‰
  devServer: {}, // å¼€å‘æœåŠ¡å™¨ï¼šrun dev/start çš„é…ç½®ï¼Œå¦‚ç«¯å£ã€proxyç­‰
  module: {}, // æ¨¡å—é…ç½®ï¼šé…ç½®loaderï¼ˆå¤„ç†é JavaScript æ–‡ä»¶ï¼Œæ¯”å¦‚ jsxã€sassã€vueã€å›¾ç‰‡ç­‰ç­‰ï¼‰
  plugins: [] // æ’ä»¶é…ç½®ï¼šæ‰“åŒ…ä¼˜åŒ–ã€èµ„æºç®¡ç†å’Œæ³¨å…¥ç¯å¢ƒå˜é‡
}
```

> æ³¨æ„è¿™ä¸ªæ–‡ä»¶æ˜¯åœ¨ node.js ä¸­è¿è¡Œçš„ï¼Œå› æ­¤ä¸æ”¯æŒ ES6 çš„ `import` è¯­æ³•ã€‚

### é…ç½®æ‰“åŒ…å…¥å£å’Œå‡ºå£

```JavaScript
// å¼•å…¥webpackè‡ªå¸¦çš„nodeæ ¸å¿ƒæ¨¡å—
const path = require('path')

module.exports = {
    // é¡µé¢å…¥å£ js æ–‡ä»¶
    entry:  './src/index.js',
    
    // é…ç½®æ‰“åŒ…è¾“å‡ºç›¸å…³
    output: {
      // æ‰“åŒ…è¾“å‡ºç›®å½•ï¼Œå¿…é¡»ä½¿ç”¨ç»å¯¹åœ°å€ï¼Œè¾“å‡ºæ–‡ä»¶å¤¹è·¯å¾„
      path: path.resolve(__dirname, 'dist'), // è§£æè·¯å¾„ä¸º ./dist
      // å…¥å£ js çš„æ‰“åŒ…è¾“å‡ºæ–‡ä»¶åï¼Œé»˜è®¤ä¸º main.js
      filename: "bundle.js" 
    }
  }
```

ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å†™æ³•ï¼š

```javascript
const path = require('path')

// é‡æ–°é…ç½®å…¥å£æ–‡ä»¶è·¯å¾„ä»¥åŠå‡ºå£æ–‡ä»¶è·¯å¾„
const PATH = {
    app:path.join(__dirname, "./src/index.js"),
    build:path.resolve(__dirname, "./dist")
}

module.exports = {
    entry:{
        //è¿™é‡Œé¢çš„keyå€¼å†³å®šäº†ä¸‹é¢nameçš„åå­—å«ä»€ä¹ˆ
        app:PATH.app
    },
    output:{
        path:PATH.build,
        filename:"[name].js" // å³app.js
    }
  }
```

> - path.join() å°†ç¬¬ä¸€ä¸ªå‚æ•°å’Œç¬¬äºŒä¸ªå‚æ•°è¿›è¡Œé“¾æ¥(è·¯å¾„è¿æ¥)ï¼Œè¯¥æ–¹æ³•çš„ä¸»è¦ç”¨é€”åœ¨äºï¼Œä¼šæ­£ç¡®ä½¿ç”¨å½“å‰ç³»ç»Ÿçš„è·¯å¾„åˆ†éš”ç¬¦ï¼ŒUnixç³»ç»Ÿæ˜¯ /ï¼ŒWindowsç³»ç»Ÿæ˜¯ \ã€‚
> - path.resolve() ä¼šæŠŠä¸€ä¸ªè·¯å¾„æˆ–è·¯å¾„ç‰‡æ®µçš„åºåˆ—å‚æ•°è§£æä¸ºä¸€ä¸ªç»å¯¹è·¯å¾„ï¼Œ ä¹Ÿå¯ä»¥å˜æˆç›¸å¯¹è·¯å¾„ã€‚
> - __dirnameï¼šå½“å‰æ–‡ä»¶å¤¹çš„ç»å¯¹è·¯å¾„ã€‚

### æ‰“åŒ… html å…¥å£æ–‡ä»¶

é€šè¿‡ä¸Šé¢çš„é…ç½®ï¼Œæˆ‘ä»¬å·²ç»å°†å…¥å£ index.js æ‰“åŒ…åˆ°äº† dist ç›®å½•ä¸‹çš„ app.js æ–‡ä»¶é‡Œï¼Œæ­¤æ—¶åœ¨æµè§ˆå™¨çš„å…¥å£æ–‡ä»¶ index.html é‡Œå¼•ç”¨è¿™ä¸ª js æ–‡ä»¶å°±èƒ½çœ‹åˆ°æˆ‘ä»¬åœ¨index.js å†™çš„ä»£ç è¿è¡Œç»“æœäº†ã€‚

å¯ä»¥ï¼Œä½†æ²¡å¿…è¦ã€‚ ğŸ˜ å› ä¸ºè¿™æ ·æ‰‹åŠ¨å¼•ç”¨ js æ–‡ä»¶æ˜¾å¾—ä¸æ™ºèƒ½ï¼Œè€Œä¸”å½“æˆ‘ä»¬ä¿®æ”¹é…ç½®æ–‡ä»¶é‡Œçš„æ‰“åŒ…è¾“å‡ºçš„æ–‡ä»¶ååï¼Œhtml é‡Œçš„å¼•ç”¨è·¯å¾„å°±ä¼šå‡ºé”™ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ [html-webpack-plugin](https://link.juejin.im/?target=https%3A%2F%2Fwebpack.docschina.org%2Fplugins%2Fhtml-webpack-plugin%2F) æ’ä»¶ä»¥ src/index.html ä¸ºæ¨¡æ¿æ¥ç”Ÿæˆ html æ–‡ä»¶ ï¼Œå¹¶å°† HTML å¼•ç”¨è·¯å¾„å’Œæˆ‘ä»¬çš„æ„å»ºç»“æœè‡ªåŠ¨å…³è”èµ·æ¥ã€‚

å®‰è£…ï¼š

`npm install html-webpack-plugin -D`

ä¿®æ”¹ webpack.config.js æ–‡ä»¶ï¼š

```javascript
const HtmlWebpackPlugin = require('html-webpack-plugin')
module.exports = {
  //...
  plugins: [
      new HtmlWebpackPlugin({
          filename: 'index.html', 
          template: './src/index.html',
          /*
      å› ä¸ºå’Œ webpack 4 çš„å…¼å®¹æ€§é—®é¢˜ï¼ŒchunksSortMode å‚æ•°éœ€è¦è®¾ç½®ä¸º none
      https://github.com/jantimon/html-webpack-plugin/issues/870
      */
          chunksSortMode: 'none'
      })
  ]
}
```

> template å‚æ•°æŒ‡å®šå…¥å£ html æ–‡ä»¶è·¯å¾„ï¼Œæ’ä»¶ä¼šæŠŠè¿™ä¸ªæ–‡ä»¶ä½œä¸ºhtmlæ¨¡æ¿äº¤ç»™ webpack å»ç¼–è¯‘ï¼Œå¹¶å°†æ„å»ºç»“æœå‚¨å­˜ä¸º html æ–‡ä»¶åˆ°è¾“å‡ºç›®å½•ï¼Œé»˜è®¤æ–‡ä»¶åä¸º index.htmlã€‚ä¹Ÿå¯ä»¥é€šè¿‡ filename å‚æ•°æŒ‡å®šè¾“å‡ºçš„æ–‡ä»¶åã€‚
>
> html-webpack-plugin ä¹Ÿå¯ä»¥ä¸æŒ‡å®š template å‚æ•°ï¼Œå®ƒä¼šä½¿ç”¨æ’ä»¶é»˜è®¤çš„ html æ¨¡æ¿ã€‚

é‡æ–°æ‰§è¡Œ npm run build ï¼Œdist ç›®å½•ä¸‹ä¼šäº§ç”Ÿä¸€ä¸ªåŒ…å«ä»¥ä¸‹å†…å®¹çš„ index.html æ–‡ä»¶ï¼š

```html
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>webpack App</title>
  </head>
  <body>
	<h2>
      è¿™æ˜¯webpack-demoçš„é¡¹ç›®å…¥å£é¡µé¢ã€‚
  	</h2>
 	<p id="test"></p>
	<script type="text/javascript" src="app.js"></script>	       	  </body>
</html>
```

> æ’ä»¶å·²ç»è‡ªåŠ¨å¸®æˆ‘ä»¬æŠŠæ‰“åŒ…åçš„ app.js æ–‡ä»¶æ­£ç¡®åœ°å¼•ç”¨åˆ°è¿™é‡Œå•¦ã€‚ğŸ¥³

### æ‰“åŒ… css/scss æ–‡ä»¶

æ¥ä¸‹æ¥å¦‚æœæˆ‘ä»¬å¸Œæœ›ä½¿ç”¨ webpack æ¥è¿›è¡Œæ„å»º css æ–‡ä»¶ï¼Œé‚£ä¹ˆå°±éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­å¼•å…¥`css-loader`å’Œ `style-loader`è¿™ä¸¤ä¸ª loader æ¥è§£æå’Œå¤„ç† cssæ–‡ä»¶ã€‚

å‰è€…å¯ä»¥è®© css æ–‡ä»¶ä¹Ÿæ”¯æŒ `import`ï¼Œå¹¶ä¸”ä¼šè§£æ cssæ–‡ä»¶ï¼Œåè€…å¯ä»¥å°†è§£æå‡ºæ¥çš„ css é€šè¿‡æ ‡ç­¾çš„å½¢å¼æ’å…¥åˆ° HTML ä¸­ï¼Œæ‰€ä»¥åè€…ä¾èµ–å‰è€…ã€‚

å¦‚æœè¦å¤„ç† scss æ–‡ä»¶ï¼Œè¿˜éœ€è¦å¼•å…¥`sass-loader`loaderï¼ŒåŒæ ·ï¼Œå®ƒä¾èµ–äºå‰ä¸¤ä¸ªloaderã€‚åŒæ—¶è¿˜è¦å®‰è£…`node-sass`ï¼Œ[node-sass](https://github.com/sass/node-sass) æ˜¯ sass-loader çš„[`peerDependency`](https://docs.npmjs.com/files/package.json#peerdependencies)ã€‚

> PSï¼šæ³¨æ„æ˜¯ sass-loader ä¸æ˜¯ scss-loader å“¦ï¼ğŸ¤ª

å®‰è£…ï¼š

`npm install css-loader style-loader sass-loader -D`

æ·»åŠ æ ·å¼æ–‡ä»¶ï¼š

```bash
cd src
mkdir styles && cd styles
touch index.scss
```

åœ¨ reset.scss æ–‡ä»¶é‡Œç¼–è¾‘æ ·å¼ä»£ç åï¼Œå¹¶ä¸”åœ¨ src/index.js ä¸­å¼•å…¥ `import './styles/index.scss'`

ä¿®æ”¹ `webpack.config.js` æ–‡ä»¶ï¼š

```javascript
module.exports = {
  //...
  /*
    é…ç½®å„ç§ç±»å‹æ–‡ä»¶çš„åŠ è½½å™¨ï¼Œç§°ä¹‹ä¸º loader
    webpack å½“é‡åˆ° import ... æ—¶ï¼Œä¼šè°ƒç”¨è¿™é‡Œé…ç½®çš„ loader å¯¹å¼•ç”¨çš„æ–‡ä»¶è¿›è¡Œç¼–è¯‘
    */
  module: {
    /**
     * test: åŒ¹é…ç‰¹å®šæ¡ä»¶ã€‚ä¸€èˆ¬æ˜¯æä¾›ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼æˆ–æ­£åˆ™è¡¨è¾¾å¼çš„æ•°ç»„
     * include: åŒ¹é…ç‰¹å®šæ¡ä»¶ã€‚ä¸€èˆ¬æ˜¯æä¾›ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–è€…å­—ç¬¦ä¸²æ•°ç»„
     * exclude: æ’é™¤ç‰¹å®šæ¡ä»¶
     * and: å¿…é¡»åŒ¹é…æ•°ç»„ä¸­çš„æ‰€æœ‰æ¡ä»¶
     * or: åŒ¹é…æ•°ç»„ä¸­ä»»ä½•ä¸€ä¸ªæ¡ä»¶
     * nor: å¿…é¡»æ’é™¤è¿™ä¸ªæ¡ä»¶
     * use: æŒ‡å®šå¤„ç†è¯¥æ–‡ä»¶çš„ loader, å€¼å¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–è€…æ•°ç»„ã€‚loader çš„æ‰§è¡Œé¡ºåºæ˜¯ä»æœ€åä¸€ä¸ªåˆ°ç¬¬ä¸€ä¸ªã€‚
     */
    rules: [
      {
        test: /\.(css|scss)$/, // åŒ¹é…csså’Œscssæ–‡ä»¶
        include: [path.resolve(__dirname, 'src')],
        use: ['style-loader', 'css-loader', 'sass-loader']
        // loaderçš„æ‰§è¡Œé¡ºåºæ˜¯ä»å³è‡³å·¦/ä»ä¸‹å¾€ä¸Šã€‚
      }
    ]
  }
  //...
}
```

å¦‚æœåŒ¹é…åˆ° scss æ–‡ä»¶é‚£ä¹ˆé¦–å…ˆç»è¿‡ sass-loader å¤„ç†ä¸º css ï¼Œç„¶å css-loader å°† css å†…å®¹å­˜ä¸º js å­—ç¬¦ä¸²ï¼Œå¹¶è½¬åŒ–æˆ CommonJS æ¨¡å—ï¼ŒæŠŠ backgroundã€@font-face ç­‰å¼•ç”¨çš„å›¾ç‰‡ï¼Œå­—ä½“æ–‡ä»¶äº¤ç»™æŒ‡å®šçš„ loader æ‰“åŒ…ã€‚æœ€å style-loader å°† js å­—ç¬¦ä¸²ç”Ÿæˆä¸º style èŠ‚ç‚¹ã€‚

ç»ç”±ä¸Šè¿° loader çš„å¤„ç†åï¼Œcss/scss ä»£ç ä¼šè½¬å˜ä¸º JSï¼Œ å¦‚æœéœ€è¦å•ç‹¬æŠŠ css æ–‡ä»¶åˆ†ç¦»å‡ºæ¥ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ [mini-css-extract-plugin](https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2Fwebpack-contrib%2Fmini-css-extract-plugin) æ’ä»¶ã€‚

### æ‰“åŒ…å›¾ç‰‡

å®‰è£…ï¼š

`npm install file-loader url-loader -D`

**file-loader:** å¯ä»¥ç”¨äºå¤„ç†å¾ˆå¤šç±»å‹çš„æ–‡ä»¶ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ç›´æ¥è¾“å‡ºæ–‡ä»¶ï¼ŒæŠŠæ„å»ºåçš„æ–‡ä»¶è·¯å¾„è¿”å›ã€‚

**url-loader:** å¦‚æœå›¾ç‰‡è¾ƒå¤šï¼Œä¼šå‘å¾ˆå¤š http è¯·æ±‚ï¼Œä¼šé™ä½é¡µé¢æ€§èƒ½ã€‚`url-loader` ä¼šå°†å¼•å…¥çš„å›¾ç‰‡ç¼–ç ï¼Œç”Ÿæˆ dataURlã€‚ç›¸å½“äºæŠŠå›¾ç‰‡æ•°æ®ç¿»è¯‘æˆä¸€ä¸²å­—ç¬¦ã€‚å†æŠŠè¿™ä¸²å­—ç¬¦æ‰“åŒ…åˆ°æ–‡ä»¶ä¸­ï¼Œæœ€ç»ˆåªéœ€è¦å¼•å…¥è¿™ä¸ªæ–‡ä»¶å°±èƒ½è®¿é—®å›¾ç‰‡äº†ã€‚å½“ç„¶ï¼Œå¦‚æœå›¾ç‰‡è¾ƒå¤§ï¼Œç¼–ç ä¼šæ¶ˆè€—æ€§èƒ½ã€‚å› æ­¤ `url-loader` æä¾›äº†ä¸€ä¸ª limit å‚æ•°ï¼Œå°äº limit å­—èŠ‚çš„æ–‡ä»¶ä¼šè¢«è½¬ä¸º DataURlï¼Œå¤§äº limit çš„è¿˜ä¼šä½¿ç”¨ `file-loader` è¿›è¡Œ copyã€‚

> - url-loader å¯ä»¥çœ‹ä½œæ˜¯å¢å¼ºç‰ˆçš„ file-loaderã€‚
> - url-loader æŠŠå›¾ç‰‡ç¼–ç æˆ base64 æ ¼å¼å†™è¿›é¡µé¢ï¼Œä»è€Œå‡å°‘æœåŠ¡å™¨è¯·æ±‚ã€‚

æ·»åŠ å›¾ç‰‡èµ„æºæ–‡ä»¶å¤¹ï¼š

```bash
cd src
mkdir assets && cd assets
mkdir images 
```

åœ¨ assets/images æ–‡ä»¶å¤¹å†…æ”¾å…¥å›¾ç‰‡ï¼Œå¹¶åœ¨ index.html å†…åŠ è½½å¼•ç”¨ï¼š`<img src="./assets/images/webpack.jpg" alt="">`ï¼Œç„¶åç¼–è¾‘é…ç½®æ–‡ä»¶

```javascript
module.exports = {
  module: {
    rules: [
      // ...
      {
        test: /\.(png|jpg|gif)$/,
        use: [
          {
            loader: 'url-loader',
            options: {
              outputPath: 'images/', //è¾“å‡ºåˆ°distçš„imagesæ–‡ä»¶å¤¹
              limit: 600 //æ˜¯æŠŠå°äº600Bçš„æ–‡ä»¶æ‰“æˆBase64çš„æ ¼å¼
            }
          }
        ]
      }
    ]
  }
  //...
}
```

æ‰§è¡Œ webpack åï¼Œæˆ‘ä»¬ä¼šå‘ç°  dist ç›®å½•ä¸‹å¤šå‡ºäº† images æ–‡ä»¶å¤¹ï¼Œé‡Œé¢å°±æ˜¯æ‰“åŒ…åçš„å›¾ç‰‡æ–‡ä»¶ã€‚è€ŒåŒæ—¶ dist å†…ç”Ÿæˆçš„ index.html æ–‡ä»¶ä¹Ÿæ­£ç¡®åŠ è½½äº†è¯¥èµ„æºã€‚`<img src="images/c3a15be258d6b4608711ca123c23c4df.jpg" alt="">`

> - å½“æ–‡ä»¶å¤§äº limit æ—¶ï¼Œurl-loader ä¼šè°ƒç”¨ file-loader, æŠŠæ–‡ä»¶å‚¨å­˜åˆ°è¾“å‡ºç›®å½•ï¼Œå¹¶æŠŠå¼•ç”¨çš„æ–‡ä»¶è·¯å¾„æ”¹å†™æˆè¾“å‡ºåçš„è·¯å¾„
>
> - å½“æ–‡ä»¶ä½“ç§¯å°äº limit æ—¶ï¼Œurl-loader æŠŠæ–‡ä»¶è½¬ä¸º Data URI çš„æ ¼å¼å†…è”åˆ°å¼•ç”¨çš„åœ°æ–¹
>
> - ```html
>   <img src="./assets/images/smallpic.png">
>   <!--ä¼šè¢«ç¼–è¯‘æˆ-->
>   <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAA...">
>   ```

### é…ç½® babel

æ¥ä¸‹æ¥ï¼Œä¸ºäº†èƒ½è®©ä¸æ”¯æŒ ES6 çš„æµè§ˆå™¨ ï¼ˆæ¯”å¦‚ IE) ä¹Ÿèƒ½ç…§å¸¸è¿è¡Œï¼Œæˆ‘ä»¬éœ€è¦å®‰è£… [babel](http://babeljs.io/), å®ƒä¼šæŠŠæˆ‘ä»¬å†™çš„ ES6 æºä»£ç è½¬åŒ–æˆ ES5ï¼Œè¿™æ ·æˆ‘ä»¬æºä»£ç å†™ ES6ï¼Œæ‰“åŒ…æ—¶ç”Ÿæˆ ES5ã€‚

å®‰è£…ï¼š

> webpack 4.x | babel-loader 8.x | babel 7.x

`npm i babel-loader @babel/core @babel/preset-env -D`

> - Babel 7.x çš„ç›¸å…³ä¾èµ–åŒ…éœ€è¦åŠ ä¸Š `@babel` scopeã€‚
> - ä¸€ä¸ªä¸»è¦å˜åŒ–æ˜¯ presets è®¾ç½®ç”±åŸæ¥çš„ `env` æ¢æˆäº† `@babel/preset-env`, å¯ä»¥é…ç½® `targets`, `useBuiltIns` ç­‰é€‰é¡¹ç”¨äºç¼–è¯‘å‡ºå…¼å®¹ç›®æ ‡ç¯å¢ƒçš„ä»£ç ã€‚
> - å…¶ä¸­ `useBuiltIns` å¦‚æœè®¾ä¸º `"usage"`ï¼ŒBabel ä¼šæ ¹æ®å®é™…ä»£ç ä¸­ä½¿ç”¨çš„ ES6/ES7 ä»£ç ï¼Œä»¥åŠä¸ä½ æŒ‡å®šçš„ targetsï¼ŒæŒ‰éœ€å¼•å…¥å¯¹åº”çš„ `polyfill`ï¼Œè€Œæ— éœ€åœ¨ä»£ç ä¸­ç›´æ¥å¼•å…¥ `import '@babel/polyfill'`ï¼Œé¿å…è¾“å‡ºçš„åŒ…è¿‡å¤§ï¼ŒåŒæ—¶åˆå¯ä»¥æ”¾å¿ƒä½¿ç”¨å„ç§æ–°è¯­æ³•ç‰¹æ€§ã€‚

- [@babel/core](https://link.juejin.im/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2F%40babel%2Fcore)ï¼šbabel æ ¸å¿ƒåº“
- [babel-loader](https://link.juejin.im/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fbabel-loader): ç”¨ babel è½¬æ¢ ES6 ä»£ç éœ€è¦ä½¿ç”¨åˆ° `babel-loader`
- [@babel-preset-env](https://link.juejin.im/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2F%40babel%2Fpreset-env)ï¼š é»˜è®¤æƒ…å†µä¸‹æ˜¯ç­‰äº ES2015 + ES2016 + ES2017ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒå¯¹è¿™ä¸‰ä¸ªç‰ˆæœ¬çš„ ES è¯­æ³•è¿›è¡Œè½¬åŒ–ã€‚

é…ç½®webpack.config.jsï¼š

```javascript
{
	test: /\.m?js$/,
    exclude: /(node_modules|bower_components)/,
    use: {
    	loader: 'babel-loader',
        options: {
          presets: ['@babel/preset-env']
        }
      }
}
```

### é…ç½®çƒ­åŠ è½½

ä¸Šé¢è®²åˆ°äº†éƒ½æ˜¯å¦‚ä½•æ‰“åŒ…æ–‡ä»¶ï¼Œä½†æ˜¯å¼€å‘ä¸­æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæœ¬åœ°æœåŠ¡ï¼Œè¿™æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `webpack-dev-server` åœ¨æœ¬åœ°å¼€å¯ä¸€ä¸ªç®€å•çš„é™æ€æœåŠ¡æ¥è¿›è¡Œå¼€å‘ã€‚

`webpack-dev-server` æ˜¯ webpack å®˜æ–¹æä¾›çš„ä¸€ä¸ªå·¥å…·ï¼Œå¯ä»¥åŸºäºå½“å‰çš„ webpack æ„å»ºé…ç½®å¿«é€Ÿå¯åŠ¨ä¸€ä¸ªé™æ€æœåŠ¡ã€‚å½“ `mode` ä¸º `development` æ—¶ï¼Œä¼šå…·å¤‡ `hot reload` çš„åŠŸèƒ½ï¼Œå³å½“æºç æ–‡ä»¶å˜åŒ–æ—¶ï¼Œä¼šå³æ—¶æ›´æ–°å½“å‰é¡µé¢ï¼Œä»¥ä¾¿ä½ çœ‹åˆ°æœ€æ–°çš„æ•ˆæœã€‚

å®‰è£…ï¼š

`npm i webpack-dev-server -D`

package.json ä¸­ scripts ä¸­æ·»åŠ ï¼š

`"start": "webpack-dev-server --mode development"`

é»˜è®¤å¼€å¯ä¸€ä¸ªæœ¬åœ°æœåŠ¡çš„çª—å£ [http://localhost:8080/](https://link.juejin.im/?target=http%3A%2F%2Flocalhost%3A8080%2F) ä¾¿äºå¼€å‘ã€‚

