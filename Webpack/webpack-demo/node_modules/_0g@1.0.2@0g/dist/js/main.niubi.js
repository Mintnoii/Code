var app=angular.module("newsApp",["ui.router","ng.post","news.controller","news.service","news.directive"]);app.config(["$stateProvider","$urlRouterProvider",function(e,o){e.state("index",{url:"/index",templateUrl:"template/index.html",controller:"indexCtrl"}).state("index.list",{url:"/list",templateUrl:"template/newsList.html",controller:"listCtrl"}).state("index.secondlist",{url:"/secondlist",templateUrl:"template/secondList.html",controller:"secondListCtrl"}).state("detail",{url:"/detail/:id",templateUrl:"template/detail.html",controller:"detailCtrl"}).state("login",{url:"/login",templateUrl:"template/logins.html",controller:"loginsCtrl"}).state("register",{url:"/register",templateUrl:"template/register.html",controller:"registerCtrl"}).state("setting",{url:"/setting",templateUrl:"template/setting.html",controller:"settingCtrl"}),o.when("","/index/list")}]),function(){var e=angular.module("news.controller",[]);e.controller("indexCtrl",["$scope","$rootScope","$http","cookie","$window",function(e,o,n,t,s){var l=t.getCookie("token"),i=t.getCookie("username");n.post("http://localhost:81/angular/news/index.php/login_api/auto_login",{params:{token:l,username:i}}).success(function(e){console.log(e),e.code||(window.location.href="#/login")}),e.tabs=[{name:"国内最新",id:1,url:"#/index/list"},{name:"游戏焦点",id:2,url:"#/index/secondlist"},{name:"登录",id:3,url:"#/login"}],o.id=1,e.toggleTab=function(e,n){console.log(e),o.id=e,s.location.href=n}}]),e.controller("listCtrl",["$scope","$http",function(e,o){e.isShowSwiper=!0,e.page=1,e.isShow=!1,e.news=[];var n=function(){o.jsonp("news.php",{params:{page:e.page,channelId:"5572a109b3cdc86cf39001db",channelName:"国内最新",callback:"JSON_CALLBACK"}}).success(function(o){e.isShow=!0,console.log(o),e.news=e.news.concat(o.showapi_res_body.pagebean.contentlist)})};n(),e.searchName="",e.isSearch=!1,e.search=function(){e.isSearch=!0},e.cancelSearch=function(){e.isSearch=!1},e.loadMore=function(){e.isShow=!1,e.page++,n()}}]),e.controller("secondListCtrl",["$scope","$http","$rootScope",function(e,o,n){e.isShowSwiper=!0,n.id=2,e.page=1,e.isShow=!1,e.news=[];var t=function(){o.jsonp("news.php",{params:{page:e.page,channelId:"5572a108b3cdc86cf39001d6",channelName:"游戏焦点",callback:"JSON_CALLBACK"}}).success(function(o){e.isShow=!0,console.log(o),e.news=e.news.concat(o.showapi_res_body.pagebean.contentlist)})};t(),e.searchName="",e.isSearch=!1,e.search=function(){e.isSearch=!0},e.cancelSearch=function(){e.isSearch=!1},e.loadMore=function(){e.isShow=!1,e.page++,t()}}]),e.controller("detailCtrl",["$scope","$http","$state",function(e,o,n){e.isShowGallery=!1,e.showGallery=function(o,n){e.isShowGallery=o,console.log(n),e.imgUrl="background-image:url("+n+")"},console.log(n.params),o.jsonp("news.php",{params:{page:1,channelId:"5572a109b3cdc86cf39001db",channelName:"国内最新",callback:"JSON_CALLBACK"}}).success(function(o){console.log(o),e.new=o.showapi_res_body.pagebean.contentlist[n.params.id],console.log(e.new)})}]),e.controller("loginsCtrl",["$scope","$http","cookie",function(e,o,n){e.login=function(){console.log("username:"+e.username),console.log("password:"+e.password),o.post("http://localhost:81/angular/news/index.php/login_api/login",{params:{username:e.username,password:e.password}}).success(function(e){console.log(e),e.code&&(n.setCookie("token",e.info.token),n.setCookie("username",e.username),window.location.href="#/index/list")})}}]),e.controller("registerCtrl",["$scope","$http","cookie",function(e,o,n){e.register=function(){console.log("username:"+e.username),console.log("password:"+e.password),o.post("http://localhost:81/angular/news/index.php/login_api/register",{params:{username:e.username,password:e.password}}).success(function(e){console.log(e),e.code&&(n.setCookie("username",e.username),n.setCookie("token",e.info.token),window.location.href="#/index/list")})}}]),e.controller("settingCtrl",["$scope","$http","cookie",function(e,o,n){var t=n.getCookie("token"),s=n.getCookie("username");o.post("http://localhost:81/angular/news/index.php/login_api/auto_login",{params:{token:t,username:s}}).success(function(e){console.log(e),e.code||(window.location.href="#/login")})}])}(),function(){var e=angular.module("news.service",[]);e.service("cookie",["$document",function(e){return{setCookie:function(o,n){var t=10,s=new Date;s.setTime(s.getTime()+24*t*60*60*1e3),e[0].cookie=o+"="+n+";expires="+s},getCookie:function(o){var n,t=new RegExp("(^|)"+o+"=([^;]*)(;|$)");if(n=e[0].cookie.match(t))return n[2]}}}])}(),function(){var e=angular.module("news.directive",[]);e.directive("newsList",[function(){return{templateUrl:"directive/newsList.html"}}]),e.directive("searchBar",[function(){return{templateUrl:"directive/searchBar.html"}}]),e.directive("swiper",[function(){return{templateUrl:"directive/swiper.html",link:function(e,o,n){new Swiper(".swiper-container",{pagination:".swiper-pagination",paginationClickable:!0})}}}])}();